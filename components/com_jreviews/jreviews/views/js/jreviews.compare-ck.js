/**
 * JReviews - Reviews Extension
 * Copyright (C) 2010-2013 ClickFWD LLC
 * This is not free software, do not distribute it.
 * For licencing information visit http://www.reviewsforjoomla.com
 * or contact sales@reviewsforjoomla.com
**/(function(e){jreviewsCompare={numberOfListingsPerPage:3,maxNumberOfListings:15,compareURL:"index.php?option=com_jreviews&url=categories/compare/id:listing_ids/",lang:{compare_heading:jreviews.__t("COMPARE_HEADING"),compare_all:jreviews.__t("COMPARE_COMPARE_ALL"),remove_all:jreviews.__t("COMPARE_REMOVE_ALL"),select_more:jreviews.__t("COMPARE_SELECT_MORE"),select_max:jreviews.__t("COMPARE_SELECT_MAX")},listingTypeID:null,init:function(){jreviewsCompare.set({numberOfListingsPerPage:jreviews.comparison.numberOfListingsPerPage,maxNumberOfListings:jreviews.comparison.maxNumberOfListings,compareURL:jreviews.comparison.compareURL});jreviewsCompare.initComparePage();jreviewsCompare.initCompareDashboard();jreviewsCompare.initListingsSelection()},set:function(t){t!==undefined&&e.extend(jreviewsCompare,t)},initComparePage:function(){var t=e(".jr-compareview"),n=e(".jr-compare-slider"),r=n.find(".jr-compare-slider-items"),i=e(".jr-compare-slider-secondary"),s=i.find(".jr-compare-slider-items2"),o=r.find(".jr-compare-slider-item"),u=e(".jrScrollbarArea"),a=e(".jr-compare-slider-item").length,f,l;t.width(t.parent().width());a>=jreviewsCompare.numberOfListingsPerPage?f=n.width()/jreviewsCompare.numberOfListingsPerPage:f=n.width()/a;l=f*a;o.width(f);r.width(l);s.width(l);n.scroll(function(){i.scrollLeft(n.scrollLeft())});i.scroll(function(){n.scrollLeft(i.scrollLeft())});if(a>jreviewsCompare.numberOfListingsPerPage){u.removeClass("jrHidden");n.removeClass("jrSliderDisabled");i.removeClass("jrSliderDisabled");t.hasClass("jrCompareViewMenu")||e(".removeComparedListing").removeClass("jrHidden");n.find(".jr-compare-slider-item").hover(function(){var t=e(this),o=t.data("listingid"),a=t.width();t.on("click","img.removeListing",function(){t.fadeOut("slow",function(){t.remove();var a=f*e("div.jr-compare-slider-item").length,l=e(".jr-compare-slider-item").length;r.width(a);s.width(a);if(l<=jreviewsCompare.numberOfListingsPerPage){u.addClass("jrHidden");n.addClass("jrSliderDisabled");i.addClass("jrSliderDisabled");n.find(".removeComparedListing").addClass("jrHidden")}e("span#removelisting"+o).trigger("click")})})})}jreviewsCompare.fixCompareAlignment()},fixCompareAlignment:function(){function t(t){tallest=0;t.each(function(){thisHeight=e(this).height();thisHeight>tallest&&(tallest=thisHeight)});t.height(tallest)}function n(n){n.each(function(){var n=e(this).attr("class").split(" ").slice(0,1);t(e("div."+n))})}var r=e("div.jr-compare-slider-item div.jrCompareField");n(r)},initCompareDashboard:function(){e("body").append('<div class="jrCompareDashboard"><div class="jrCompareHeader"><div class="jrCompareArrow"></div></div><div class="jrCompareTabs"></div></div>');e(".jrCompareTabs").append('<div class="jrCompareTitle">'+jreviewsCompare.lang.compare_heading+'</div><ul class="jrTabsNav"></ul><div class="jrTabsContainer"></div>');e(".jrCompareHeader, .jrCompareTitle, ul.jrTabsNav").hover(function(){e(this).css("cursor","pointer")}).click(function(){e(".jrCompareTabs .jrTabsContainer").slideToggle("slow",function(){var t=e(".jrCompareArrow");e(this).is(":visible")?t.addClass("down"):t.removeClass("down")})});var t=e(".jrCompareDashboard"),n=jreviewsCompare.getListingsFromStorage();if(!e.isEmptyObject(n)){t.slideDown("slow");e.each(n,function(t,r){var i=!1,s=t.substring(11);e.each(n[t],function(e,t){if(!i){jreviewsCompare.insertTab(t);i=!0}jreviewsCompare.insertListingIntoComparison(t);jreviewsCompare.updateCompareAllUrl(t)});e("#tabLT"+s+" li.ltItem").length>4&&e("#tabLT"+s+" a.compareNext").css("visibility","visible")})}t.on("click","span.removeItem",function(){var t=e(this).attr("id"),n={id:t.substring(13),typeId:e(this).text()};e("input.listing"+n.id).attr("checked",!1);jreviewsCompare.removeListingFromComparison(n)});t.on("click","a.removeListings",function(t){t.preventDefault();var n=e(this).parent().attr("id"),r=n.substring(9),i=e("#tabLT"+r+" li.ltItem:first-child span.removeItem").attr("id").substring(13),s={id:i,typeId:r},o=e('.jrCheckListing[data-listingtypeid="'+r+'"]');o.attr("checked",!1);jreviewsCompare.removeTab(s)});t.on("click","a.compareListings",function(t){t.preventDefault();var n=e(this).parent().attr("id").substring(9),r=e("div#tabLT"+n+" ul.ltList li").length;if(r<2){if(e("p.comparisonMessage."+n).val()!==""){e("div#tabLT"+n).append('<p class="comparisonMessage '+n+' jrPopup">'+jreviewsCompare.lang.select_more+"</p>");e("p.comparisonMessage").hide().fadeIn("slow",function(){setTimeout(function(){e("p.comparisonMessage").fadeOut("slow",function(){e(this).remove()})},3e3)})}}else{var i=e(this).attr("href");window.location.href=i}});e("ul.jrTabsNav").on("click","a",function(t){t.stopPropagation();var n=e(".jrTabsContainer");n.is(":hidden")&&n.slideDown("slow")})},insertTab:function(t){var n=t.typeId,r=t.typeTitle,i=e(".jrCompareTabs");i.data("ui-tabs")&&i.tabs("destroy");e(".jrCompareTabs ul.jrTabsNav").append('<li><a href="#tabLT'+n+'" class="listingTypeCompare jrCompare'+n+'">'+r+' <span class="numSelected">(0)</span></a></li>');e(".jrCompareTabs .jrTabsContainer").append('<div id="tabLT'+n+'" class="ui-helper-clearfix"><div class="jrCompareScroll"><ul class="ltList"></ul></div></div>');compareURL=jreviewsCompare.compareURL.replace("listing_ids",t.id);var s='<a rel="nofollow" href="'+compareURL+'" class="compareListings jrButton jrSmall listingType'+n+'"><span class="jrIconCompare"></span>'+jreviewsCompare.lang.compare_all+"</a>",o='<a href="#" class="removeListings jrButton jrSmall listingType'+n+'"><span class="jrIconRemove"></span>'+jreviewsCompare.lang.remove_all+"</a>";e(".jrTabsContainer #tabLT"+n).append('<div id="jrCompare'+n+'" class="jrCompareButtons">'+s+o+"</div>");var u=e(".jrCompareTabs ul.jrTabsNav li").length,a=e("base").attr("href");a!==undefined&&a.length&&i.find('ul.jrTabsNav li a:not(".jrBaseUpdated")').each(function(){e(this).addClass("jrBaseUpdated").attr("href",e(location).attr("href")+e(this).attr("href"))});i.tabs({selected:u-1})},removeTab:function(t){var n=e(".jrCompareDashboard"),r=e(".jrCompareTabs"),i=r.tabs("option","selected"),s=r.tabs("length");if(s>1){e("ul.jrTabsNav li.ui-tabs-active").fadeOut("slow",function(){r.tabs("remove",i)});r.tabs("destroy");i>0?r.tabs({selected:i-1}):r.tabs({selected:0})}else n.slideUp("slow",function(){r.tabs("remove",i);r.tabs("destroy")});jreviewsCompare.removeListingTypeFromStorage(t)},insertListingIntoComparison:function(t){t.thumbSrc.length?t.thumb='<div class="compareThumb"><a href="'+t.url+'"><img src="'+t.thumbSrc+'" /></a></div>':t.thumb="";t.titleUrl='<a href="'+t.url+'">'+t.title+"</a>";e("div#tabLT"+t.typeId+" ul").append('<li id="listing'+t.id+'" class="ltItem"><span id="removelisting'+t.id+'" data-icon="&#xe018;" class="removeItem">'+t.typeId+"</span>"+t.thumb+'<span class="compareItemTitle">'+t.titleUrl+"</span></li>");e("input.listing"+t.id).attr("checked","checked");var n=jreviewsCompare.getNumberOfSelectedListings(t.typeId);n++;e(".jrCompareTabs a.jrCompare"+t.typeId+" span.numSelected").html("("+n+")")},removeListingFromComparison:function(t){var n=e(".jrCompareTabs");if(e("li#listing"+t.id).siblings().length>0){e("li#listing"+t.id).fadeOut("slow",function(){e(this).remove()});jreviewsCompare.updateNumberOfSelectedListings(t.typeId,-1);jreviewsCompare.removeListingFromStorage(t);jreviewsCompare.updateCompareAllUrl(t)}else jreviewsCompare.removeTab(t)},initListingsSelection:function(){e(".jrPage, .jrModuleContainer").on("click","input.jrCheckListing",function(){var t={id:e(this).attr("value"),title:e(this).data("listingtitle"),url:e(this).data("listingurl"),thumbSrc:e(this).data("thumburl"),typeId:e(this).data("listingtypeid"),typeTitle:e(this).data("listingtypetitle"),location:e(this).data("location")};if(t.thumbSrc.length)t.thumb='<div class="compareThumb"><a href="'+t.url+'"><img src="'+t.thumbSrc+'" /></a></div>';else{thumb=e("img[data-listingid='"+t.id+"']");if(thumb.length){thumbSrc=thumb.attr("src");t.thumbSrc=thumbSrc;t.thumb='<div class="compareThumb"><a href="'+t.url+'"><img src="'+thumbSrc+'" /></a></div>'}else t.thumb=""}t.titleUrl='<a href="'+t.url+'">'+t.title+"</a>";t.data='<li id="listing'+t.id+'" class="ltItem">'+t.thumb+'<span class="compareItemTitle">'+t.titleUrl+'</span><span id="removelisting'+t.id+'" data-icon="&#xe018;" class="removeItem">'+t.typeId+"</span></li>";var n=e(".jrCompareDashboard"),r=e(".jrCompareTabs"),i=e(".jrTabsContainer"),s=e(".jrCompareArrow"),o;if(e(this).is(":checked")){o=e("input.listing"+t.id+":not(:checked)");e.each(o,function(){e(this).attr("checked","checked")});if(e("div#tabLT"+t.typeId).length>0){if(i.is(":hidden")){i.slideDown("slow");s.addClass("down")}var u=jreviewsCompare.getNumberOfSelectedListings(t.typeId);if(u>=jreviewsCompare.maxNumberOfListings){if(e("p.comparisonMessageMax."+t.id).val()!==""){e(this).parent().append('<p class="comparisonMessageMax '+t.id+' jrPopup">'+jreviewsCompare.lang.select_max+"</p>");e("p.comparisonMessageMax").hide().fadeIn("slow",function(){setTimeout(function(){e("p.comparisonMessageMax").fadeOut("slow",function(){e(this).remove()})},3e3)})}return!1}e(t.data).appendTo("div#tabLT"+t.typeId+" ul.ltList").hide().fadeIn("slow");r.tabs("select","#tabLT"+t.typeId)}else{if(i.is(":hidden")){i.show();s.addClass("down")}jreviewsCompare.insertTab(t);e(t.data).appendTo("div#tabLT"+t.typeId+" ul.ltList").hide().fadeIn("slow");n.is(":hidden")&&n.slideDown("slow")}jreviewsCompare.updateNumberOfSelectedListings(t.typeId,1);jreviewsCompare.saveListingToStorage(t);jreviewsCompare.updateCompareAllUrl(t)}else{o=e("input.listing"+t.id+":checked");e.each(o,function(){e(this).attr("checked",!1)});r.tabs("select","#tabLT"+t.typeId);jreviewsCompare.removeListingFromComparison(t)}})},getNumberOfSelectedListings:function(t){var n=e(".jrCompareTabs a.jrCompare"+t+" span.numSelected").html().slice(1,-1);return parseInt(n,10)},updateNumberOfSelectedListings:function(t,n){var r=jreviewsCompare.getNumberOfSelectedListings(t);r+=n;e(".jrCompareTabs a.jrCompare"+t+" span.numSelected").html("("+r+")")},updateCompareAllUrl:function(t){var n=e("a.compareListings.listingType"+t.typeId),r=n.attr("href"),i=jreviewsCompare.getListingsFromStorage(t.typeId),s=[];e.each(i,function(e,t){s.push(t.id)});s=s.toString();var o=jreviewsCompare.compareURL.replace("listing_ids",s);n.attr("href",o)},saveListingToStorage:function(t){var n=t.typeId,r=t.id,i={};i["listingType"+n]={};i["listingType"+n]["listing"+r]=t;var s=jreviewsCompare.getListingsFromStorage();if(!e.isEmptyObject(s)){var o=e.extend({},s);o["listingType"+n]=e.extend({},o["listingType"+n],i["listingType"+n]);localStorage.setItem("jrCompare",JSON.stringify(o))}else localStorage.setItem("jrCompare",JSON.stringify(i))},getListingsFromStorage:function(e){var t={},n="";n=localStorage.getItem("jrCompare");if(n!==""&&n!=="{}"){t=JSON.parse(n);e!==undefined&&(t=t["listingType"+e])}return t},removeListingFromStorage:function(e){var t=jreviewsCompare.getListingsFromStorage();delete t["listingType"+e.typeId]["listing"+e.id];localStorage.setItem("jrCompare",JSON.stringify(t))},removeListingTypeFromStorage:function(e){var t=jreviewsCompare.getListingsFromStorage();delete t["listingType"+e.typeId];localStorage.setItem("jrCompare",JSON.stringify(t))}}})(jQuery);