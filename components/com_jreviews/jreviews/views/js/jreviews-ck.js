/**
 * JReviews - Reviews Extension
 * Copyright (C) 2010-2013 ClickFWD LLC
 * This is not free software, do not distribute it.
 * For licencing information visit http://www.reviewsforjoomla.com
 * or contact sales@reviewsforjoomla.com
**/(function(e,t){var n=e("div.jr-page");e(document).ajaxStop(function(){jreviews.addOnloadAjax("datepicker",jreviews.datepicker);jreviews.addOnloadAjax("popup",jreviews.popup);jreviews.addOnloadAjax("tabs",jreviews.tabs);jreviews.addOnloadAjax("listing-manager",jreviews.listing.manager);e.each(jreviews._onloadFnAjax,function(e,n){n!==t&&n()})});jreviews=e.extend(jreviews,{lang:jreviews.lang||{},_onloadFn:[],_onloadFnAjax:[],_onloadFnKeys:[],_onloadFnAjaxKeys:[]});jreviews.addOnload=function(t,n){if(e.inArray(t,jreviews._onloadFnKeys)==-1){jreviews._onloadFn.push(n);jreviews._onloadFnKeys.push(t)}};jreviews.addOnloadAjax=function(t,n){if(e.inArray(t,jreviews._onloadFnAjaxKeys)==-1){jreviews._onloadFnAjax.push(n);jreviews._onloadFnAjaxKeys.push(t)}};jreviews.onload=function(){n=n.length>0?n:e("div.jr-page");jreviews.addOnload("datepicker",jreviews.datepicker);jreviews.addOnload("popup",jreviews.popup);jreviews.addOnload("showmore",jreviews.showmore);jreviews.addOnload("lightbox",jreviews.lightbox);jreviews.addOnload("favorite",jreviews.listing.favorite);jreviews.addOnload("tabs",jreviews.tabs);jreviews.addOnload("login",jreviews.login.init);jreviews.addOnload("social-sharing",jreviews.socialSharing);jreviews.addOnload("pagenav",jreviews.pageNav);jreviews.addOnload("listing-create",jreviews.listing.formSetup);jreviews.addOnload("listing-manager",jreviews.listing.manager);jreviews.addOnload("listing-widgets",jreviews.listing.widgets);jreviews.addOnload("listing-claim",jreviews.claim.init);jreviews.addOnload("listing-inquiry",jreviews.inquiry.init);jreviews.addOnload("listing-masonry",jreviews.masonry);jreviews.addOnload("review-init",jreviews.review.init);jreviews.addOnload("review-edit",jreviews.review.edit);jreviews.addOnload("review-vote",jreviews.review.vote);jreviews.addOnload("review-reply",jreviews.review.reply);jreviews.addOnload("report",jreviews.report.init);jreviews.addOnload("comment-manager",jreviews.discussion.manager);jreviews.addOnload("comment-new",jreviews.discussion.init);jreviews.addOnload("comment-reply",jreviews.discussion.reply);jreviews.addOnload("comment-earlier",jreviews.discussion.earlierComment);jreviews.addOnload("media-init",jreviews.media.init);jreviews.addOnload("media-thumbs",jreviews.media.generateThumbs);jreviews.addOnload("media-manager",jreviews.media.manager);jreviews.addOnload("media-download",jreviews.media.download);jreviews.addOnload("search-simple",jreviews.search.simple);jreviews.addOnload("search-adv-page",jreviews.search.advancedPage);jreviews.addOnload("search-adv-module",jreviews.search.advancedModule);jreviews.addOnload("directory-tree",jreviews.directoryTree);jreviews.addOnload("facebook",jreviews.facebook.load);jreviews.addOnload("comparison",jreviews.compare);jreviews.addOnload("module-slider",jreviews.module.init);e.each(jreviews._onloadFn,function(e,n){n!==t&&n()})};typeof head=="function"?head.ready(function(){jreviews.onload()}):e(function(){jreviews.onload()});jreviews.ajax_params=function(){return"&Itemid="+jrPublicMenu};jreviews.getScript=function(n,r){return e.ajax({type:"GET",url:n,success:function(){t!==r&&r()},dataType:"script",cache:!0})};jreviews.__t=function(t,n){var r={add_ul:!0};n=e.extend(r,n);if(typeof t=="string")return jreviews.lang[t]||t;var i=[];e.each(t,function(e,t){var n,r;if(typeof t=="string")n=jreviews.lang[t]||t;else{r=jreviews.lang[t.shift()];t.unshift(r);n=window.sprintf.apply(null,t)}i.push("<li>"+n+"</li>")});return n.add_ul?"<ul>"+i.join("")+"</ul>":i.join("")};jreviews.dispatch=function(n){n=n||{};var r=n.form_id!==t||n.form!==t?"POST":"GET";t!==n.method&&(r=n.method);var i=n.controller!==t?e.param({"data[controller]":n.controller,"data[action]":n.action}):{},s=n.type||"json";if(t!==n.form_id||t!==n.form){var o=n.form||e("#"+n.form_id);t!==n.controller&&o.find("input[name=data\\[controller\\]], input[name=data\\[action\\]]").remove();i=o.serialize()+"&"+i}n.data&&(i=i+"&"+e.param(n.data));return e.ajax({type:r,url:s2AjaxUri,data:i,dataType:n.type})};jreviews.compare=function(){"undefined"!=typeof jreviewsCompare&&jreviewsCompare.init()};jreviews.datepicker=function(){if(e().datepicker){try{jreviews.datepickerClear()}catch(t){}e.datepicker.setDefaults({showOn:"both",buttonImage:jreviews.calendar_img,showButtonPanel:!0,buttonImageOnly:!0,buttonText:"Calendar",dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0});e('.jr-date:not(".jr_ready")').addClass("jr-ready").each(function(){e(this).datepicker({yearRange:e(this).data("yearrange"),minDate:e(this).data("mindate"),maxDate:e(this).data("maxdate")})})}};jreviews.datepickerClear=function(){var t=e.datepicker._updateDatepicker;e.datepicker._updateDatepicker=function(n){t.call(this,n);var r=e(this).datepicker("widget").find(".ui-datepicker-buttonpane");r.find(".clearDate").length===0&&e("<button class='clearDate' type='button' class='ui-datepicker-clean ui-state-default ui-priority-primary ui-corner-all'>"+jreviews.__t("CLEAR_DATE")+"</button>").appendTo(r).click(function(t){e.datepicker._clearDate(n.input)})}};jreviews.directoryTree=function(){e().treeview&&e(".jr-directory-tree").treeview({animated:"fast",unique:!0,collapsed:!1}).each(function(){var t=e(this),n=t.data("cat-id"),r=t.data("dir-id"),i=t.data("show-dir"),s=null;n?s=e(".jr-tree-cat-"+n):r&&i&&(s=e(".jr-tree-dir-"+r));if(s!==null){s.removeClass("closed").swapClass("expandable","collapsable").swapClass("expandable-hitarea","collapsable-hitarea").swapClass("lastExpandable-hitarea","lastCollapsable-hitarea").swapClass("lastExpandable","lastCollapsable");s.parents("ul, li").show().removeClass("closed").swapClass("expandable","collapsable").swapClass("expandable-hitarea","collapsable-hitarea").swapClass("lastExpandable-hitarea","lastCollapsable-hitarea").swapClass("lastExpandable","lastCollapsable");s.children("ul, li").show().removeClass("closed");s.children("div").swapClass("expandable","collapsable").swapClass("expandable-hitarea","collapsable-hitarea");s.parents("ul, li").children("div").swapClass("expandable-hitarea","collapsable-hitarea").swapClass("lastExpandable-hitarea","lastCollapsable-hitarea")}})};jreviews.tabs=function(n){if(typeof e().tabs!="undefined"){n=n||e('div.jr-page .jr-tabs:not(".jr-ready")');var r=e("base").attr("href");r!==t&&r.length&&n.find("ul a").each(function(){e(this).attr("href",jQuery(location).attr("href")+e(this).attr("href"))});n.addClass("jr-ready").tabs()}};jreviews.pageNav=function(){n.on("click",'div.jr-pagenav[data-ajax="1"] a',function(t){t.preventDefault();e(this).trigger("jrPageNav")});n.on("change",'div.jr-pagenav[data-ajax="1"] select.jr-pagenav-limit',function(t){t.preventDefault();e(this).trigger("jrPageNav")});n.on("jrPageNav",'div.jr-pagenav[data-ajax="1"] a, div.jr-pagenav[data-ajax="1"] select.jr-pagenav-limit',function(t){t.preventDefault();var r=e(this),i=r.closest("form"),s=n.find("div.jr-pagenav"),o=Number(e("div.jr-pagenav select.jr-pagenav-limit").first().find(":selected").text()),u=1,a=Number(s.find("a.jr-pagenav-page").last().html()),f=[],l=i.find('input[name="data[controller]"]').val(),c=i.find('input[name="data[action]"]').val()||"index";o===0&&(o=i.find('input[name="data[limit]"]').val()||10);if(r.hasClass("jr-pagenav-page"))u=Number(r.html());else if(r.hasClass("jr-pagenav-next")){u=Number(r.siblings("span.jr-pagenav-current").html())+1;u=u>a?u:u}else if(r.hasClass("jr-pagenav-prev")){u=Number(r.siblings("span.jr-pagenav-current").html())-1;u=u<0?1:u}f.push({name:"page",value:u});f.push({name:"limit",value:o});var h=jreviews.dispatch({method:"get",type:"html",controller:l,action:c,data:f});h.done(function(e){r.closest(".jr-page-inner, .jr-page").first().html(e)})})};jreviews.socialSharing=function(){n.find(".jr-tweet").length&&function(e,t,n){var r,i=e.getElementsByTagName(t)[0];if(e.getElementById(n))return;r=e.createElement(t);r.src="//platform.twitter.com/widgets.js";i.parentNode.insertBefore(r,i)}(document,"script","twitter-jssdk");var e=n.find(".jr-gplusone");if(e.length){e.remove();(function(e,t,n){var r,i=e.getElementsByTagName(t)[0];if(e.getElementById(n))return;r=e.createElement(t);r.id=n;r.src="//apis.google.com/js/plusone.js";i.parentNode.insertBefore(r,i)})(document,"script","google-jssdk")}var t=n.find(".jr-linkedin");if(t.length){t.remove();(function(e,t,n){var r,i=e.getElementsByTagName(t)[0];if(e.getElementById(n))return;r=e.createElement(t);r.id=n;r.src="//platform.linkedin.com/in.js";i.parentNode.insertBefore(r,i)})(document,"script","linkedin-jssdk")}n.find(".jr-pinterest").length&&function(e,t,n){var r,i=e.getElementsByTagName(t)[0];if(e.getElementById(n))return;r=e.createElement(t);r.id=n;r.src="//assets.pinterest.com/js/pinit.js";i.parentNode.insertBefore(r,i)}(document,"script","pinterest-jssdk")};jreviews.login={init:function(){n.on("click",".jr-show-login",function(){e("#jr-login-form").toggle()})}};jreviews.discussion={init:function(){var n=e("div.jr-form-comment-outer"),r=n.find('form[id^="jr-form-comment"]'),i=r.attr("id"),s=r.data("discussion-id"),o=r.find(".jr-buttons"),u=r.find(".jr-validation"),a=e("button.jr-comment-add");a.on("click",function(t){t.preventDefault();var r=e(this);n.slideDown();r.fadeOut()});a.one("click",function(e){jreviews.common.initForm(i,!0);jreviews.common.validateUsername(r)}).trigger("click");r.on("click","button.jr-comment-cancel",function(e){e.preventDefault();n.slideUp();a.fadeIn()});r.on("click","button.jr-comment-submit",function(i){i.preventDefault();var s=e(".jr-review-comments");o.find("button").attr("disabled","disabled");o.append('<span class="jrLoadingSmall">');u.hide();var a=jreviews.dispatch({form:r});a.done(function(e){if(e.success){n.slideUp().remove();var i='<div class="jr-message jrSuccess">'+(e.moderation?jreviews.__t("DISCUSSION_SUBMIT_MODERATED"):jreviews.__t("DISCUSSION_SUBMIT_NEW"))+"</div>";s.prepend('<div class="jr-new-comment jrHidden">'+i+e.html+"</div>").jrScrollTo({duration:500,offset:-50}).delay().find(".jr-new-comment").slideDown(1500).find("div.jr-message").delay(4e3).slideUp(500);jreviews.discussion.manager();jreviews.discussion.earlierComment()}else{e.str.length&&u.html(jreviews.__t(e.str)).show();var o=r.find("div.jr-captcha img");if(e.captcha!==t&&o.length){o.attr("src",e.captcha);r.find("input.jr-captcha-code").val("")}}});a.always(function(){o.find(".jrLoadingSmall").remove();o.find("button").removeAttr("disabled")})})},reply:function(){e('button.jr-comment-reply:not(".jr-ready")').on("click",function(t){t.preventDefault();var n=e(this),r=n.find("span").eq(1),i=n.data("discussion-id"),s=n.data("review-id"),o=jreviews.dispatch({method:"get",type:"html",controller:"discussions",action:"reply",data:{discussion_id:i,review_id:s}});o.done(function(t){var i={},s=function(){var t=e(this),n=t.find("form").last();jreviews.common.initForm(n.attr("id"),!0);jreviews.common.validateUsername(n);t.on("click",".jr-show-login",function(){t.find(".jr-login-form").toggle()})};i[jreviews.__t("SUBMIT")]=function(){jreviews.discussion.submitReply(n,e(this))};i[jreviews.__t("CANCEL")]=function(){e(this).dialog("close")};var o=e.jrDialog(t,{buttons:i,title:r.html(),open:s,width:"640px"});o.find(".jr-form-comment-outer").show()})}).addClass("jr-ready")},manager:function(){var t=e('ul.jr-comment-manager:not(".jr-ready")').addClass("jr-ready");t.on("click","a.jr-comment-edit",function(){var t=e(this),n=t.find("span").eq(1),r=t.data("discussion-id"),i=jreviews.dispatch({method:"get",type:"html",controller:"discussions",action:"edit",data:{discussion_id:r}});i.done(function(r){var i={};i[jreviews.__t("SUBMIT")]=function(){jreviews.discussion.submitEdit(t,e(this))};i[jreviews.__t("CANCEL")]=function(){e(this).dialog("close")};var s=e.jrDialog(r,{buttons:i,title:n.html(),width:"640px"});s.find(".jr-form-comment-outer").show()})});t.on("click","a.jr-comment-delete",function(){var t=e(this),n=t.data("discussion-id"),r=t.data("token"),i=t.find("span").eq(1),s=new e.Deferred;s.done(function(e){var i={id:n,token:r},s=jreviews.dispatch({method:"get",type:"json",controller:"discussions",action:"_delete",data:i});s.done(function(n){if(n.success){e.dialog("close");t.closest(".jr-layout-outer").html('<div class="jrSuccess">'+jreviews.__t("DISCUSSION_DELETED")+"</div>").jrScrollTo()}else{e.dialog("option","buttons",[]);n.str.length&&e.html(jreviews.__t(n.str))}})});var o={};o[i.html()]=function(){s.resolve(e(this))};o[jreviews.__t("CANCEL")]=function(){e(this).dialog("close")};e.jrDialog(jreviews.__t("DISCUSSION_DELETE_CONFIRM"),{buttons:o,title:i.html(),width:"640px"})})},submitReply:function(n,r){var i=r.find("form").last(),s=i.attr("id"),o=i.find(".jr-validation");o.hide();var u=jreviews.dispatch({form:i});u.done(function(s){if(s.success){r.dialog("close");var u='<div class="jr-message jrSuccess">'+(s.moderation?jreviews.__t("DISCUSSION_SUBMIT_MODERATED"):jreviews.__t("DISCUSSION_SUBMIT_NEW"))+"</div>",a=e('<div class="jr-new-comment jrHidden">'+u+s.html+"</div>");n.closest(".jr-layout-outer").after(a);a.jrScrollTo({duration:500,offset:-50}).delay().slideDown(1500).find("div.jr-message").delay(4e3).slideUp(500)}else if(s.str.length){o.html(jreviews.__t(s.str)).show();var f=i.find("div.jr-captcha img");if(s.captcha!==t&&f.length){f.attr("src",s.captcha);i.find("input.jr-captcha-code").val("")}}jreviews.discussion.manager()})},submitEdit:function(t,n){var r=n.find("form"),i=r.attr("id"),s=r.find(".jr-validation");s.hide();var o=jreviews.dispatch({form:r});o.done(function(r){if(r.success){n.dialog("close");var i=e('<div class="jr-message jrSuccess" style="margin-top:10px;">'+(r.moderation?jreviews.__t("DISCUSSION_SUBMIT_MODERATED"):jreviews.__t("DISCUSSION_SUBMIT_EDIT"))+"</div>"),o=e('<div class="jr-new-comment jrClear jrHidden">'+r.html+"</div>"),u=t.closest(".jr-layout-inner");u.html(i).prepend(o);o.jrScrollTo({duration:500,offset:-50}).delay().slideDown(1500)}else r.str.length&&s.html(jreviews.__t(r.str)).show();jreviews.discussion.manager();jreviews.discussion.earlierComment()})},earlierComment:function(){e(".jr-earlier-comment").each(function(){var t=e(this),n=t.data("post-id"),r=t.next(".jr-earlier-comment-content"),i=e.Deferred();i.done(function(){var e=jreviews.dispatch({method:"get",type:"html",controller:"discussions",action:"getPost",data:{id:n}});e.done(function(e){r.html(e)})});t.jrPopup({className:"jrPopup",delay:500,onBeforeShow:function(){if(r.html()===""){r.html('<span class="jrLoadingMedium"></span>');i.resolve()}}})})}};jreviews.module={init:function(){e("div.jr-module-slider, div.jr-plugin-slider").not(".jr-ready").addClass("jr-ready").each(function(){var t=e(this),n=t.find(".jrModuleItems"),r=t.find(".jr-results"),i=t.data("options");if(i.page_count<2)return;t.removeClass("jrSliderSinglePage");i.orientation=="vertical"&&t.addClass("jrSliderVertical");i.nav_position=="side"&&t.addClass("jrSliderSideArrows");var s=n.bxSlider({mode:i.orientation,speed:600,easing:"ease",oneToOneTouch:!0,auto:parseInt(i.slideshow,10),pause:i.slideshow_interval*1e3,autoHover:!0,pager:!0}),o=t.closest(".jr-tabs");o.length&&o.bind("tabsshow",function(e,n){n.panel.id==t.closest(".ui-tabs-panel").attr("id")&&s.reloadSlider()})})}};jreviews.lightbox=function(){e("a.fancyvideo").length>0&&e("a.fancyvideo").magnificPopup({type:"iframe",callbacks:{elementParse:function(e){e.src=e.src+"&lightbox=1&tmpl=component"}}});e("a.fancybox").length>0&&e(".jrPage").magnificPopup({delegate:"a.fancybox",type:"image",mainClass:"mfp-fade",gallery:{enabled:!0,preload:[0,2],navigateByImgClick:!0,arrowMarkup:'<button title="%title%" type="button" class="mfp-arrow mfp-arrow-%dir%"></button>',tCounter:'<span class="mfp-counter">%curr% of %total%</span>'}})};jreviews.media={init:function(){if("undefined"==typeof jreviewsMedia)return!1;jreviews.media.formSetup();var t=e("div.jr-listing-media"),n=t.find(".jr-tabs-media"),r=["photo","photo_owner","photo_user","video","video_owner","video_user","audio","attachment"];t.find("div.jr-media-sortable").sortable({axis:"y",containment:"parent",handle:".jr-sort-handle",cursor:"move",stop:jreviewsMedia.reorder});e(r).each(function(e,n){t.find("div#"+n).length?t.find('a[href="#'+n+'"]').closest("li").show():t.find('a[href="#'+n+'"]').closest("li").remove()});jreviews.tabs(n);jreviewsMedia.videoGallery.init();jreviewsMedia.photoGallery.init();jreviewsMedia.audioPlayer()},generateThumbs:function(){e('img[data-thumbnail="1"]').not(".jr-ready").each(function(){var t=e(this);t.addClass("jr-ready");var n={"data[media_id]":e(this).data("media-id"),"data[size]":e(this).data("size"),"data[mode]":e(this).data("mode")},r=jreviews.dispatch({method:"get",type:"json",controller:"media_upload",action:"generateThumb",data:n});r.done(function(e){if(e.success&&e.url!==""){var n=t.closest("div");n.css("max-width")!="none"?t.css({width:n.css("max-width"),height:"auto"}):t.css({width:e.width+"px",height:e.height+"px"});t.attr("src",e.url)}})})},formSetup:function(){var t=e("div.jr-media-upload"),n=t.find("#jr-media-uploader"),r=n.data("android");if(t.length){var i=t.find("form#jr-user-info");try{if(jreviews.paid.plan.plan_selected){var s=e('<input type="hidden" name="data[plan_id]">').val(jreviews.paid.plan.plan_selected);t.find("form").append(s)}}catch(o){}jreviews.common.validateUsername(i);jreviews.common.initForm("jr-user-info",!0);var u=t.find("form#jr-form-media-upload"),a=u.data("file-validation");jreviewsMedia.initUploader("jr-media-uploader",{fileValidation:a,multiple:r?!1:!0});var f=t.find(".jr-upload-button"),l=f.find("input"),c=t.find(".jr-upload-mobile-options");if(c.length){f.hide();c.on("change",function(){var t=e(this).val();l.removeAttr("multiple");t=="multiple"&&l.attr("multiple","multiple");t!==""&&l.trigger("click")}).buttongroup()}}},manager:function(){var t=e(".jr-page");t.on("click",".jr-media-edit",function(){var t=e(this),n=t.data("media-id"),r=t.find("span").eq(1),i=jreviews.dispatch({method:"get",type:"html",controller:"media",action:"_edit",data:{media_id:n}});i.done(function(n){var i={};i[jreviews.__t("SUBMIT")]=function(){jreviews.media.editSubmit(t,e(this))};i[jreviews.__t("CANCEL")]=function(){e(this).find("#jr-video-player").trigger("jrVideoDestroy");e(this).find("#jr-audio-player").remove();e(this).dialog("close")};var s=function(){e(this).find("#jr-video-player").trigger("jrVideoDestroy");e(this).find("#jr-audio-player").remove()},o=function(){var t=e(this),n=t.find("div.jr-video-gallery"),r=t.find("#jr-audio-player"),i=t.find(".jr-thumbnails");i.length&&i.find(".jr-thumb-del").on("click",function(){var t=e(this);if(t.data("delete")==1){t.data("delete",0);var n={id:t.data("id"),size:t.data("size")},r=t.data("token");r&&(n[r]=1);var i=jreviews.dispatch({method:"get",type:"json",controller:"media",action:"_deleteThumb",data:n});i.done(function(n){n.success?t.fadeOut(500):n.str.length&&e.jrAlert(jreviews.__t(n.str))})}}).on("mouseenter",function(){var t=e(this),n=e('<span class="jrIconDelete jrIconOnly">');e(this).data("delete",1).data("contents",e(this).html()).css("width",e(this).width()+"px").css("height",e(this).height()+"px").html(n)}).on("mouseleave",function(){e(this).data("delete",0).html(e(this).data("contents"))});n.length&&jreviewsMedia.videoGallery.init();r.length&&jreviewsMedia.audioPlayer();jreviews.common.userAutocomplete(t.find("form"))},u=e.jrDialog(n,{buttons:i,title:r.html(),open:o,close:s,width:"800px"})})});t.on("click",".jr-media-delete",function(){var t=e(this),n=t.data("media-id"),r=t.data("token"),i=t.data("lang"),s=t.find("span").eq(1),o={},u=new e.Deferred;u.done(function(i){o[r]=1;o["data[Media][media_id]"]=n;var s=jreviews.dispatch({method:"get",type:"json",controller:"media",action:"_delete",data:o});s.done(function(n){if(n.success){i.dialog("close");t.closest(".jr-layout-outer").css("background-image","none").animate({backgroundColor:"#f7f1ac"},600).promise().done(function(){e(this).slideUp(600,function(){e(this).remove()})})}else{i.dialog("option","buttons",[]);i.html(jreviews.__t(n.str))}})});var a={};a[jreviews.__t("DELETE")]=function(){u.resolve(e(this))};a[jreviews.__t("CANCEL")]=function(){e(this).dialog("close")};e.jrDialog(jreviews.__t("MEDIA_DELETE_CONFIRM"),{buttons:a,title:s.html(),width:"640px"})});t.on("click",".jr-media-publish",function(){var t=e(this),n=t.find("span").eq(0),r=t.data("media-id"),i=t.data("token"),s=t.data("states"),o={on:jreviews.__t("PUBLISHED"),off:jreviews.__t("UNPUBLISHED")},u={media_id:r};u[i]=1;var a=jreviews.dispatch({method:"get",type:"json",controller:"media",action:"_publish",data:u});a.done(function(t){if(t.success){n.attr("class",t.state==1?s.on:s.off);n.next().is("span")?n.next().html(t.state==1?o.on:o.off):n.attr("title",t.state==1?o.on:o.off)}else e.jrAlert(jreviews.__t(t.str))})});t.on("click","button.jr-media-main",function(){var n=e(this),r=n.find("span").eq(0),i=n.data("listing-id"),s=n.data("media-id"),o=n.data("token"),u=n.data("states"),a={listing_id:i,media_id:s};a[o]=1;n.attr("disabled","disabled");var f=jreviews.dispatch({method:"get",type:"json",controller:"media",action:"setMainMedia",data:a});f.done(function(i){if(i.success===!0){var s=function(){t.find("button.jr-media-main").not(n).removeAttr("disabled").each(function(){e(this).find("span").eq(0).attr("class",u.off)})};e.when(s()).done(function(){r.attr("class",u.on)})}})})},editSubmit:function(e,t){var n=t.find("form"),r=jreviews.dispatch({form:n});r.done(function(n){if(n.success){t.dialog("close");e.closest(".jr-layout-inner").find(".jr-media-title a").html(n.title)}else{t.dialog("option","buttons",[]);t.html(jreviews.__t(n.str))}})},download:function(){e(".jr-page").on("click","button.jr-media-download",function(){var t=e(this),n=t.data("media-id"),r=t.data("token-s"),i=t.data("token-i");if(jreviews.iOS)window.open(s2AjaxUri+"&url=media/download&m="+n+"&"+r+"=1&"+i+"=1");else{e("#jr-download-"+n).remove();var s=e('<iframe id="jr-download-'+n+'" style="display:none;"></iframe>');s.attr("src",s2AjaxUri+"&url=media/download&m="+n+"&"+r+"=1&"+i+"=1").appendTo("body")}})}};jreviews.inquiry={init:function(){var t=e("button.jr-send-inquiry-embedded");if(t.length){jreviews.common.initForm("jr-form-inquiry");t.on("click",function(e){e.preventDefault();jreviews.inquiry.submit()})}e("button.jr-send-inquiry").on("click",function(t){t.preventDefault();var n=e(this),r=n.data("listing-id"),i=n.find("span").eq(1),s=jreviews.dispatch({method:"get",type:"html",controller:"inquiry",action:"create",data:{id:r}});s.done(function(t){var n={};n[jreviews.__t("SUBMIT")]=function(){jreviews.inquiry.submit(e(this))};n[jreviews.__t("CANCEL")]=function(){e(this).dialog("close")};e.jrDialog(t,{buttons:n,title:i.html(),width:"640px"});jreviews.common.initForm("jr-form-inquiry",!0)})})},submit:function(n){var r=e("#jr-form-inquiry-outer"),i=r.find(".jr-validation"),s;s=n?n.find("form"):r.find("form");r.find(".jr-validation").hide();i.hide().html("");var o=jreviews.dispatch({form:s});o.done(function(t){if(t.success){n&&n.dialog("option","buttons",[]);r.html(jreviews.__t("INQUIRY_SUBMIT"))}else{t.str.length&&i.html(jreviews.__t(t.str)).show();e.each(t.inputs,function(e,t){r.find("#jr-inquiry-"+t).siblings("label").find(".jr-validation-input").show()});n&&n.trigger("failedValidation")}});o.always(function(e){var n=s.find("div.jr-captcha img");if(e.captcha!==t&&n.length){n.attr("src",e.captcha);s.find("input.jr-captcha-code").val("")}})}};jreviews.masonry=function(){var t,r,i,s,o,u=function(){t=a.parent().width();f>150?r=Math.floor(t/f):r=Math.floor(t/150);i=(r-1)*12;s=r*2;o=(t-i-s)/r;a.find(".jrListItem").css({width:o})},a=n.find(".jr-masonry-results"),f=a.find(".jrListItem:first").data("thumbwidth"),l=a.find(".jrListItem:first").data("rtl");if(a.length&&e().masonry){u();a.masonry({itemSelector:".jrListItem",columnWidth:function(e){return e/r},gutterWidth:0,isFitWidth:!0,isResizable:!0,isRTL:l,isAnimated:!0,animationOptions:{duration:300}});e(window).on("resize",function(){u();a.masonry("reload")})}};jreviews.claim={init:function(){e("button.jr-listing-claim").on("click",function(t){t.preventDefault();var n=e(this),r=n.data("listing-id"),i=n.data("state"),s=n.find("span").eq(1);if(i=="no-access")e.jrAlert(jreviews.__t("CLAIM_REGISTER"));else{var o=jreviews.dispatch({method:"get",type:"html",controller:"claims",action:"create",data:{listing_id:r}});o.done(function(t){var n={};n[jreviews.__t("SUBMIT")]=function(){jreviews.claim.submit(e(this))};n[jreviews.__t("CANCEL")]=function(){e(this).dialog("close")};e.jrDialog(t,{buttons:n,title:s.html(),width:"640px"})})}})},submit:function(e){var t=e.find("form"),n=t.find(".jr-validation");n.html("").hide();var r=jreviews.dispatch({form:t});r.done(function(r){if(r.success){e.dialog("option","buttons",[]);t.html(jreviews.__t("CLAIM_SUBMIT"))}else if(r.str.length)n.html(jreviews.__t(r.str)).show();else{e.trigger("failedValidation");n.html(jreviews.__t("CLAIM_VALIDATE_MESSAGE")).show()}})}};jreviews.listing={favorite:function(){e("button.jr-listing-favorite").on("click",function(t){t.preventDefault();var n=e(this),r=n.find("span").eq(0),i=n.find("span").eq(1),s=n.data("states"),o=n.data("listing-id");n.attr("disabled","disabled");switch(n.data("state")){case"favored":var u=jreviews.dispatch({method:"get",type:"json",controller:"listings",action:"_favoritesDelete",data:{"data[listing_id]":o}});u.done(function(t){if(t.success){n.data("state","not_favored");r.attr("class",s.not_favored);i.html(jreviews.__t("FAVORITE_ADD"));e(".jr-favorite-"+o).html(t.count).effect("highlight",{},1e3)}else e.jrAlert(jreviews.__t(t.str))});u.always(function(){n.removeAttr("disabled")});break;case"not_favored":var a=jreviews.dispatch({method:"get",type:"json",controller:"listings",action:"_favoritesAdd",data:{"data[listing_id]":o}});a.done(function(t){if(t.success){n.data("state","favored");r.attr("class",s.favored);i.html(jreviews.__t("FAVORITE_REMOVE"));e(".jr-favorite-"+o).html(t.count).effect("highlight",{},1e3)}else e.jrAlert(jreviews.__t(t.str))});a.always(function(){n.removeAttr("disabled")});break;case"no_access":e.jrAlert(jreviews.__t("FAVORITE_REGISTER"))}})},manager:function(){var t=e('ul.jr-listing-manager:not(".jr-ready")').addClass("jr-ready");t.on("click","a.jr-listing-publish,a.jr-listing-feature",function(){var t=e(this),n=t.find("span").eq(0),r=t.find("span").eq(1),i=t.data("states"),s=t.data("listing-id"),o=t.data("token"),u={id:s},a,f;u[o]=1;switch(t.attr("class")){case"jr-listing-publish":a="_publish";f={on:jreviews.__t("PUBLISHED"),off:jreviews.__t("UNPUBLISHED")};break;case"jr-listing-feature":a="_feature";f={on:jreviews.__t("FEATURED"),off:jreviews.__t("NOT_FEATURED")}}var l=jreviews.dispatch({method:"get",type:"json",controller:"listings",action:a,data:u});l.done(function(t){if(t.success){n.attr("class",t.state==1?i.on:i.off);r.html(t.state==1?f.on:f.off)}else e.jrAlert(jreviews.__t(t.str))})});t.on("click","a.jr-listing-delete",function(){var t=e(this),n=t.find("span").eq(1),r=t.data("listing-id"),i=t.data("token"),s={id:r};s[i]=1;var o=new e.Deferred;o.done(function(e){var n=jreviews.dispatch({method:"get",type:"json",controller:"listings",action:"_delete",data:s});n.done(function(n){if(n.success){e.dialog("close");t.closest(".jr-layout-outer").html('<div class="jrSuccess">'+jreviews.__t("LISTING_DELETED")+"</div>").jrScrollTo()}else{e.dialog("option","buttons",[]);e.html(jreviews.__t(n.str))}})});var u={};u[n.html()]=function(){o.resolve(e(this))};u[jreviews.__t("CANCEL")]=function(){e(this).dialog("close")};e.jrDialog(jreviews.__t("LISTING_DELETE_CONFIRM"),{buttons:u,title:n.html(),width:"640px"})})},formSetup:function(){var r=n.find("form#jr-form-listing"),i=r.find(".jr-form-categories-outer"),s=r.find(".jr-form-listing-fields"),o=i.find(".jr-cat-select"),u=r.data("listing-id"),a=parseInt(r.data("cat-id"),10);if(u){var f=e('<span class="jrLoadingSmall">'),l=r.jreviewsFields({entry_id:e("#listing_id","#jr-form-listing").val(),value:!1,page_setup:!0,referrer:"listing"});i.append(f);if(l)l.done(function(){s.show().find(".jr-wysiwyg-editor").tinyMCE();f.remove()});else{s.show().find(".jr-wysiwyg-editor").tinyMCE();f.remove()}}jreviews.listing.submitCategory(r);if(a){var c=o.last().removeAttr("disabled").trigger("change");u||o.attr("disabled","disabled")}r.on("change","input#jr-review-optional",function(){n.find(".jr-form-review").slideToggle()});r.on("click","button.jr-cancel-listing",function(e){e.preventDefault();history.go(-1)});r.on("click","button.jr-submit-listing",function(n){n.preventDefault();var s=e(this),o=r.closest(".jr-form-listing-outer"),f=r.find(".jr-buttons"),l=r.find(".jr-wysiwyg-editor"),c=r.find(".jr-validation"),h=0,p=[],d,v;e("select[id^=cat_id]").each(function(){var t=e(this).val();t>0&&p.push(e(this))});h=p.length;if(h==1)r.find("#category").val(p[0].find("option:selected").text().replace(/(- )+/,""));else if(h>1){r.find("#category").val(p[h-1].find("option:selected").text().replace(/(- )+/,""));r.find("#parent_category").val(p[h-2].find("option:selected").text().replace(/(- )+/,""))}try{l.RemoveTinyMCE()}catch(m){}r.jrSetValidFields().join(",");f.find("button").attr("disabled","disabled");f.append('<span class="jrLoadingSmall">');c.hide();(a||u)&&i.find("select").removeAttr("disabled");var g=jreviews.dispatch({form:r});g.done(function(e){if(e.success===!0){if(e.facebook&&e.moderation===!1){var n={id:e.listing_id};n[e.token]=1;jreviews.dispatch({method:"get",type:"html",controller:"facebook",action:"_postListing",data:n})}if(e.plgBeforeRenderListingSave){s.trigger("plgBeforeRenderListingSave",e);return!1}o.jrScrollTo({duration:400,offset:-100},function(){o.html(function(){var n="",r="",i="";if(e.moderation===!1){i=e.is_new?jreviews.__t("LISTING_SUBMIT_NEW"):jreviews.__t("LISTING_SUBMIT_EDIT");n='<div class="jrSuccess">'+i+'&nbsp;<a class="jrButton" href="'+e.url+'">'+jreviews.__t("LISTING_GO_TO")+"</a>"+"</div>"}else n='<div class="jrSuccess">'+jreviews.__t("LISTING_SUBMIT_MODERATED")+"</div>";e.mediaForm!==t&&(r=e.mediaForm);return n+r});jreviews.tabs(o.find(".jr-tabs"));jreviews.media.formSetup()})}else{e.str&&e.str.length&&c.html(jreviews.__t(e.str)).show();e.editor&&l.tinyMCE();var i=r.find("div.jr-captcha img");if(e.captcha!==t&&i.length){i.attr("src",e.captcha);r.find("input.jr-captcha-code").val("")}}});g.always(function(){(a||u)&&i.find("select").attr("disabled","disabled");r.find("#valid_fields").remove();f.find(".jrLoadingSmall").remove();r.find("button").removeAttr("disabled")})})},submitCategory:function(n){var r=e('<div class="jrRoundedPanel" style="text-align:center;"><span class="jrLoadingMedium" style="display:inline;padding:20px;"></span>'+jreviews.__t("Loading...")+"</div>");n.on("change",".jr-cat-select",function(i){var s=e(this);formChooser=n.find(".jr-form-categories-outer"),formFields=n.find(".jr-form-listing-fields"),formCategories=n.find(".jr-form-categories"),listing_id=parseInt(n.data("listing-id"),10),selected_cat_id=parseInt(n.find(".jr-cat-select").last().val(),10),editing=listing_id>0;var o=formCategories.find("select").index(s)+1;if(editing)return!1;n.find(".jr-wysiwyg-editor").RemoveTinyMCE();var u=[];e(".jr-form-categories").find('select[disabled="disabled"]').each(function(){u.push(e(this))});var a=formChooser.find("select,input").removeAttr("disabled").serializeArray();e(u).each(function(){e(this).attr("disabled","disabled")});a.push({name:"data[level]",value:o});a.push({name:"data[catid]",value:s.val()});var f=jreviews.dispatch({method:"get",type:"json",controller:"listings",action:"_loadForm",data:a});r.insertAfter(formChooser);var l=new e.Deferred;l.done(function(e,t){try{e.jreviewsFields(t)}catch(r){}jreviews.review.starRating(n)});var c=new e.Deferred;c.done(function(e){var t=formFields.jreviewsFields(e);try{t.done(function(e){jreviews.common.validateUsername(n);var t=n.find("fieldset.jr-form-review");t.length&&l.resolve(t,{fieldLocation:"Review",entry_id:0,value:!1,page_setup:!0,referrer:"review"},selected_cat_id,"listingFormReview")})}catch(r){}});c.always(function(){r.remove();formFields.show()});f.done(function(i){if(i.level!==t){var s=formCategories.children("select");s.each(function(t){t>i.level&&e(this).remove()})}i.select!==t&&formCategories.append(i.select);switch(i.action){case"show_form":formFields.html(i.html);try{formFields.find(".jr-wysiwyg-editor").tinyMCE()}catch(o){}c.resolve({entry_id:listing_id,value:!1,page_setup:!0,referrer:"listing",res:i});jreviews.facebook.init(n);break;case"hide_form":r.remove();formFields.hide();break;case"no_access":r.remove();formFields.html(jreviews.__t("LISTING_SUBMIT_DISALLOWED")).show()}})})},widgets:function(){var r=n.filter(".jr-listing-detail"
),i=[];if(!r.length)return;r.find(".jr-tabs").find("li>a").each(function(t,n){var r=e(n).attr("href");i[r]=e(n).parent("li")});typeof jrRelatedWidgets!="undefined"&&jrRelatedWidgets.length&&e(jrRelatedWidgets).each(function(n,r){var s=r.favorites?"module_favorite_users":"module_listings",o=jreviews.dispatch({method:"get",type:"html",controller:s,action:"index",data:r});o.done(function(n){var s=r.target_class!==""?r.target_class:r.target_id,o=r.target_class!==""?e("."+r.target_class):e("#"+r.target_id);if(n!==""){var u=e('<div id="'+s+"Widget"+r.key+'"></div>').addClass("jrWidget");r.title&&u.append('<h3 class="jrHeading">'+r.title+"</h3>");u.append(n);o.append(u);var a=[0,1,2,3,4];for(var f=0;f<a.length;f++)a[f]=e("#"+s+"Widget"+a[f]);for(var f=0;f<a.length;f++)o.append(a[f]);i["#"+s]!==t&&o.html()!==""&&i["#"+s].show()}else i["#"+s]!==t&&o.html()===""&&i["#"+s].hide();jreviews.module.init();jreviews.media.generateThumbs()})})}};jreviews.review={setup:function(t,n){var r=e("form#"+t),i=r.closest("div.jr-form-review-outer");jreviews.review.starRating(i);jreviews.common.validateUsername(i);jreviews.common.initForm(t,!0);jreviews.facebook.init(r);var s=r.jreviewsFields({fieldLocation:"Review",entry_id:n,value:!1,page_setup:!0,referrer:"review"});s&&s.done(function(){n===0&&i.slideDown().delay().jrScrollTo({duration:500,offset:-50})})},init:function(){var r=n.find("div.jr-form-review-outer"),i=n.find(".jr-tabs"),s=r.find('form[id^="jr-form-review"]'),o=s.attr("id"),u=s.data("review-id"),a=s.find(".jr-buttons"),f=s.find("div.jr-validation"),l=n.find("#userReviews"),c=n.find("button.jr-review-add, div.jr-review-add"),h=n.find(".jr-owner-reply-del"),p=document.URL;c.on("click",function(t){t.preventDefault();var i=e(this),o=s.parents(".jr-page").find(".jr-tabs");o.length&&o.tabs("select","#reviewsTab");if(s.length){s.jrScrollTo();n.find('button.jr-review-add:not(".jr-listing-info")').fadeOut();r.slideDown("fast").jrScrollTo({duration:500,offset:-50})}else l.jrScrollTo()});s.on("click","button.jr-review-cancel",function(e){e.preventDefault();r.slideUp();n.find('button.jr-review-add:not(".jr-listing-info")').fadeIn().delay().jrScrollTo({duration:500,offset:-50})});c.one("click",function(e){s.length&&jreviews.review.setup(o,u)});s.on("click","button.jr-review-submit",function(n){n.preventDefault();var i=e(".jr-user-reviews");s.jrSetValidFields().join(",");a.find("button").attr("disabled","disabled");a.append('<span class="jrLoadingSmall">');f.hide();var o=jreviews.dispatch({form:s});o.done(function(e){if(e.success){r.slideUp().remove();if(e.facebook&&e.moderation===!1){var n={id:e.review_id};n[e.token]=1;jreviews.dispatch({method:"get",type:"html",controller:"facebook",action:"_postReview",data:n})}var o="";e.moderation===!1&&(o='<div class="jr-message jrSuccess">'+(e.review_type=="user"?jreviews.__t("REVIEW_SUBMIT_NEW"):jreviews.__t("REVIEW_SUBMIT_NEW_REFRESH"))+"</div>");i.prepend('<div class="jr-new-review jrHidden">'+o+e.html+"</div>").jrScrollTo({duration:500,offset:-50}).delay().find(".jr-new-review").slideDown(1500).find("div.jr-message").delay(4e3).slideUp(500);jreviews.review.edit();jreviews.review.vote();jreviews.popup()}else{e.str.length&&f.html(jreviews.__t(e.str)).show();var u=s.find("div.jr-captcha img");if(e.captcha!==t&&u.length){u.attr("src",e.captcha);s.find("input.jr-captcha-code").val("")}}});o.always(function(){s.find("#jr-valid_fields").remove();a.find(".jrLoadingSmall").remove();a.find("button").removeAttr("disabled")})});h.on("click",function(t){t.preventDefault();var n=e(this),r=n.data("review-id");token=n.data("token"),text=n.find("span").eq(1);var i=new e.Deferred;i.done(function(e){var t={id:r};t[token]=1;var i=jreviews.dispatch({method:"get",type:"json",controller:"owner_replies",action:"_delete",data:t});i.done(function(t){if(t.success){e.dialog("close");n.closest(".jr-owner-reply-outer").replaceWith('<div class="jrSuccess">'+jreviews.__t("OWNER_REPLY_DELETED")+"</div>")}else{e.dialog("option","buttons",[]);t.str.length&&e.html(jreviews.__t(t.str))}})});var s={};s[jreviews.__t("DELETE")]=function(){i.resolve(e(this))};s[jreviews.__t("CANCEL")]=function(){e(this).dialog("close")};var o=e.jrDialog(jreviews.__t("OWNER_REPLY_DELETE_CONFIRM"),{buttons:s,title:text.html(),width:"640px"})});if(p.match("#reviewForm$")||p.match("#userReviews$")){i.length&&e(".jr-tabs").tabs("select","#reviewsTab").jrScrollTo({duration:500,offset:-100});p.match("#reviewForm$")&&c.first().trigger("click")}},edit:function(){e('.jr-review-edit:not(".jr-ready")').on("click",function(){var t=e(this),n=t.find("span").eq(1),r=t.data("review-id"),i=t.data("referrer"),s="jr-form-review-"+r,o=e("#jr-form-review-0"),u=e('<div id="jr-form-review-placeholder" class="jrHidden"></div>');o.before(u);var a=o.detach(),f=jreviews.dispatch({method:"get",type:"html",controller:"reviews",action:"_edit",data:{review_id:r}});f.done(function(o){var f={};f[jreviews.__t("SUBMIT")]=function(){jreviews.review.editSubmit(t,e(this),u,a)};f[jreviews.__t("CANCEL")]=function(){u.after(a);u.remove();e(this).dialog("close")};var l=e.jrDialog(o,{buttons:f,title:n.html(),width:"800px",height:600});l.find("form").append('<input name="data[referrer]" type="hidden" value='+i+">");jreviews.review.setup(s,r);jreviews.common.userAutocomplete(l)})}).addClass("jr-ready")},editSubmit:function(n,r,i,s){var o=n.closest(".jr-layout-inner"),u=r.find("form"),a=u.attr("id"),f=e(".ui-dialog-buttonpane"),l=u.find(".jr-validation").clone();f.find(".jr-validation").fadeOut().remove();u.jrSetValidFields().join(",");var c=jreviews.dispatch({form:u});c.done(function(e){if(e.success){i.after(s);i.remove();r.dialog("close");var n="";o.hide(0).html(function(){e.moderation===!1&&(n='<div class="jr-message jrSuccess">'+(e.review_type=="user"?jreviews.__t("REVIEW_SUBMIT_EDIT"):jreviews.__t("REVIEW_SUBMIT_EDIT_REFRESH"))+"</div>");return n+e.html}).jrScrollTo({duration:500,offset:-50}).delay().slideDown(1500).find("div.jr-message").delay(4e3).slideUp(500)}else{if(e.str.length){l.html(jreviews.__t(e.str));f.prepend(l);l.fadeIn()}var a=u.find("div.jr-captcha img");if(e.captcha!==t&&a.length){a.attr("src",e.captcha);u.find("input.jr-captcha-code").val("")}}jreviews.review.edit();jreviews.review.vote();jreviews.popup()});c.always(function(){u.find("#jr-valid_fields").remove()})},starRating:function(t){t.find(".jr-rating-stars").each(function(){var t=e(this),n=t.data("selector"),r=t.data("inc"),i=e("<span></span>");if(n=="stars"){t.parent().next().append(i);var s=1/r;t.stars({split:s,captionEl:i})}})},reply:function(){e('button.jr-owner-reply:not(".jr-ready")').on("click",function(t){var n=e(this),r=n.find("span").eq(1),i=n.data("review-id"),s=jreviews.dispatch({method:"get",type:"html",controller:"owner_replies",action:"create",data:{review_id:i}});s.done(function(t){var i={};i[jreviews.__t("SUBMIT")]=function(){jreviews.review.replySubmit(n,e(this))};i[jreviews.__t("CANCEL")]=function(){e(this).dialog("close")};e.jrDialog(t,{buttons:i,title:r.html(),width:"640"})})})},replySubmit:function(e,t){var n=t.find("form"),r=n.find(".jr-validation"),i=jreviews.dispatch({form:n});r.hide();i.done(function(n){if(n.success){t.html(jreviews.__t(n.str));t.dialog("option","buttons",[]);e.attr("disabled","disabled")}else{t.trigger("failedValidation");r.html(jreviews.__t(n.str)).show()}})},vote:function(){e('div.jr-review-vote:not(".jr-ready")').on("click","button",function(t){t.preventDefault();var n=e(this),r=n.data("vote"),i=n.closest(".jr-review-vote"),s=i.data("state"),o=i.data("review-id"),u=n.find("span").eq(0),a=n.find("span").eq(1);i.unbind("click").find("button").attr("disabled","distabled");if(s!="access")e.jrAlert(jreviews.__t(s=="register"?"REVIEW_VOTE_REGISTER":"ACCESS_DENIED"));else{var f={"data[Vote][review_id]":o,"data[type]":r},l=jreviews.dispatch({method:"get",type:"json",controller:"votes",action:"_save",data:f});l.done(function(t){if(t.success){a.html(parseInt(a.html(),10)+1);if(t.facebook){var n={id:o};n[t.token]=1;var r=jreviews.dispatch({method:"get",type:"json",controller:"facebook",action:"_postVote",data:n});r.done(function(e){try{typeof e=="object"&&FB.ui(e)}catch(t){console.log(t)}})}}else t.str.length&&e.jrAlert(jreviews.__t(t.str))})}}).addClass("jr-ready")}};jreviews.report={init:function(){n.off("click","button.jr-report").on("click","button.jr-report",function(t){t.preventDefault();var n=e(this),r={listing_id:n.data("listing-id"),review_id:n.data("review-id"),post_id:n.data("post-id"),m:n.data("media-id"),extension:n.data("extension")},i=jreviews.dispatch({method:"get",type:"html",controller:"reports",action:"create",data:r});i.done(function(t){var n={};n[jreviews.__t("SUBMIT")]=function(){jreviews.report.submit(e(this))};n[jreviews.__t("CANCEL")]=function(){e(this).dialog("close")};e.jrDialog(t,{buttons:n,title:jreviews.__t("REPORT_INAPPROPRIATE"),width:"640"})})})},submit:function(e){var t=e.find("form"),n=t.find(".jr-validation");n.html("").hide();var r=jreviews.dispatch({form:t});r.done(function(r){if(r.success){e.dialog("option","buttons",[]);t.html(jreviews.__t("REPORT_SUBMIT"))}else{e.trigger("failedValidation");n.html(jreviews.__t(r.str)).show()}})}};jreviews.facebook={buttons_class:"jr-buttons",enable:!1,permissions:!1,uid:null,load:function(){var t=jreviews.fb.appid||null;if(jreviews.fb.xfbml||jreviews.fb.post||n.find(".jr-fb-like").length||n.find(".jr-fb-send").length){e("#fb-root").length||e("body").append('<div class="jrHidden" id="fb-root"></div>');var r=window.fbAsyncInit;window.fbAsyncInit=function(){typeof r=="function"&&r();typeof jfbc=="undefined"&&FB.init({appId:t,status:!0,cookie:!0,xfbml:!0,oauth:!0})};(function(e,t,n){var r,i=e.getElementsByTagName(t)[0];if(e.getElementById(n))return;r=e.createElement(t);r.id=n;r.async=!0;r.src="//connect.facebook.net/"+jreviews.locale+"/all.js";i.parentNode.insertBefore(r,i)})(document,"script","facebook-jssdk")}},init:function(e){if(jreviews.fb.post){jreviews.facebook.form=e;jreviews.facebook.checkPermissions()}},login:function(){jreviews.facebook.uid===null&&FB.login(function(t){t.authResponse?jreviews.facebook.uid=t.authResponse.userID:e("#jr-fb-publish").attr("checked",!1)},{scope:"publish_stream"})},checkPermissions:function(){jreviews.facebook.FBInit=setInterval(function(){FB.getLoginStatus(function(e){if(e.status==="connected"){jreviews.facebook.uid=e.authResponse.userID;FB.api({method:"fql.query",query:"SELECT publish_stream FROM permissions WHERE uid= "+e.authResponse.userID},function(e){e[0].publish_stream?jreviews.facebook.addButton(!0):FB.login(function(e){e.authResponse&&jreviews.facebook.addButton(!0)},{scope:"publish_stream"})})}else jreviews.facebook.addButton(!1)})},100)},addButton:function(n){clearInterval(jreviews.facebook.FBInit);jreviews.facebook.permissions=n;if(jreviews.facebook.form===t)return!1;var r=jreviews.facebook.form.find("."+jreviews.facebook.buttons_class);if(n===!0&&!jreviews.fb.optout)r.prepend('<input id="jr-fb-publish" name="data[fb_publish]" value="1" type="hidden" />');else{var i=e('<div class="jrFacebookPublish"><input id="jr-fb-publish" name="data[fb_publish]" type="checkbox"><div class="jrButton jrBlue"><span class="fb_button_text"><label for="jr-fb-publish">'+jreviews.__t("FACEBOOK_PUBLISH")+"</label></span></div>"+"</div>").on("click","input",function(){this.checked&&jreviews.facebook.login()});r.find("#jr-fb-publish").length===0&&r.prepend(i);n&&jreviews.fb.optout&&i.find("input").attr("checked","checked")}}};jreviews.common={initForm:function(t,n){var r=typeof t=="string"?e("#"+t):r,i=r.find("div.jr-captcha");r.one("mouseover",function(){var n=jreviews.dispatch({method:"get",type:"json",controller:"common",action:"_initForm",data:{"data[form_id]":t,"data[captcha]":i.length}});n.done(function(t){r.find("span.jr_token :input").attr("name",t.token);t.captcha&&r.find(".jr-captcha").html(t.captcha).fadeIn();r.find("input.jr-user-name").val(t.name);r.find("input.jr-user-username").val(t.username).attr("placeholder",jreviews.__t("USERNAME_CREATE_ACCOUNT")).on("focus mouseover",function(){e(this).closest("div").find(".jr-more-info").trigger("mouseover")}).on("blur mouseout",function(){e(this).closest("div").find(".jr-more-info").trigger("mouseout")});r.find("input.jr-user-email").val(t.email);r.find("input.jr-user-name, input.jr-user-username, input.jr-user-email").each(function(){var t=e(this).val();t!==""?e(this).attr("disabled","disabled"):e(this).removeAttr("disabled")})})});n===!0&&r.trigger("mouseover")},validateUsername:function(t){t.off("focusout","input.jr-user-username:text").on("focusout","input.jr-user-username:text",function(){var t=e(this),n=t.closest("form"),r=e('<input class="jr-valid-username" type="hidden" name="data[valid_username]" value="0" />'),i={username:t.val()},s=e('<span class="jrLoadingSmall"></span>');n.find(".jr-valid-username").remove();t.next("span").remove();if(t.val()==="")return;t.after(s);jreviews.dispatch({method:"get",type:"json",controller:"users",action:"_validateUsername",data:i}).done(function(e){s.remove();if(e.success){t.after('<span class="jrSuccess" style="padding:3px 8px;">'+e.text+"</span>");n.append(r.val(1))}else{t.after('<span class="jrError" style="padding:3px 8px;">'+e.text+"</span>");n.append(r.val(0))}})})},userAutocomplete:function(t){var n=t.find("input.jr-user-autocomplete"),r={target_userid:"jr-user-id-ac",target_name:"jr-user-name-ac",target_username:"jr-user-username-ac",target_email:"jr-user-email-ac"};if(n.val()===""){var i=t.find("."+r.target_userid).val();if(Number(i)>0){var s=jreviews.dispatch({method:"get",type:"text",controller:"users",action:"_getUsername",data:{id:i}});s.done(function(e){n.val(e)})}}n.autocomplete({source:function(e,t){var r=n.data("cache")||{},i=e.term;if(i in r){t(r[i]);return}var s=jreviews.dispatch({method:"get",type:"json",controller:"users",action:"_getList",data:{q:i}});s.done(function(e){r[i]=e;n.data("cache",r);t(e)})},select:function(e,n){t.find("."+r.target_userid).val(n.item.id);t.find("."+r.target_email).val(n.item.email);t.find("."+r.target_name).val(n.item.name);t.find("."+r.target_username).val(n.item.username)},minLength:2});e(".ui-autocomplete").css("white-space","nowrap")},listingAutocomplete:function(t,n){var r=n.acfield||t.find("input.jr-listing-autocomplete"),i={target_listingid:"jr-listing-id-ac",target_title:"jr-listing-title-ac",target_alias:"jr-listing-alias-ac",target_url:"jr-listing-url-ac"};if(r.val()===""){var s=t.find("."+i.target_listingid).val();if(Number(s)>0){var o=jreviews.dispatch({frontend:!0,method:"get",type:"json",controller:"listings",action:"_getList",data:{id:s}});o.done(function(e){n.onSelect?n.onSelect(r,e[0]):r.val(e[0].value)})}}r.on("blur",function(){r.val()===""&&t.find("."+i.target_listingid+", ."+i.target_title+", ."+i.target_alias+", ."+i.target_url).val("")}).autocomplete({source:function(e,t){var n=r.data("cache")||{},i=e.term;if(i in n){t(n[i]);return}var s=jreviews.dispatch({frontend:!0,method:"get",type:"json",controller:"listings",action:"_getList",data:{search:i}});s.done(function(e){n[i]=e;r.data("cache",n);t(e)})},select:function(e,s){t.find("."+i.target_listingid).val(s.item.id);t.find("."+i.target_title).val(s.item.value);t.find("."+i.target_alias).val(s.item.alias);t.find("."+i.target_url).val(s.item.url);n.onSelect&&n.onSelect(r,s)},minLength:2});e(".ui-autocomplete").css("white-space","nowrap")}};jreviews.search={submit_delay:150,simple:function(){e("form.jr-simple-search").on("click","button.jr-search",function(){e(this).closest("form").attr("action",s2AjaxUri).submit()})},advancedPage:function(){var t=e("#jr-form-adv-search"),n=t.find(".jr-listing-type-outer"),r=e('<div class="jrRoundedPanel" style="text-align:center;"><span class="jrLoadingMedium" style="display:inline;padding:20px;"></span>'+jreviews.__t("Loading...")+"</div>");t.attr("action",s2AjaxUri).on("click","button.jr-search",function(n){n.preventDefault();e(this).trigger("jrBeforeSearch");setTimeout(function(){t.submit()},jreviews.search.submit_delay)});jreviews.search.searchRange(t);t.on("change","select.jr-listing-type,input.jr-listing-type",function(t){t.preventDefault();var i=e(this),s=i.closest("form"),o=i.val(),u=s.find("div.jr-search-fields");if(parseInt(o,10)===0){u.fadeOut();return!1}r.insertAfter(n);submittingAction=jreviews.dispatch({method:"get",type:"html",controller:"search",action:"_loadForm",data:{criteria_id:o}});submittingAction.done(function(e){u.html(e);var t=u.jreviewsFields({page_setup:!0,referrer:"adv_search"});t?t.done(function(){r.remove();s.trigger("jrSearchFormLoaded");u.show()}):r.remove()})});var i=t.find("input.jr-listing-type").val();i>0&&t.find("input.jr-listing-type").trigger("change")},advancedModule:function(){e("form.jr-form-adv-search-module").each(function(){var t=e(this),n=t.data("module-id");jreviews.search.searchRange(t);t.attr("action",s2AjaxUri).on("click","button.jr-search",function(n){n.preventDefault();e(this).trigger("jrBeforeSearch");setTimeout(function(){t.submit()},jreviews.search.submit_delay)});t.jreviewsFields({page_setup:!0,recallValues:!0,referrer:"adv_search_module"})})},searchRange:function(t){t.on("change","select.jr-search-range",function(){var t=e(this),n=t.parent().find("span").last();t.val()=="between"?n.show():n.hide().find("input").val("")})}};jreviews.popup=function(){e(".jr-more-info").not("jr-ready").jrPopup({className:"jrPopup",delay:150}).addClass("jr-ready")};jreviews.showmore=function(){e(".jr-show-more").not("jr-ready").jrShowMore().addClass("jr-ready")}})(jQuery);(function(e){e.jrDialog=function(t,n){e("div.jr-dialog").dialog("destroy").remove();var r={},i=e('<div class="jr-dialog jrDialogContent jrHidden"></div>');r={title:"",width:"640px",height:"auto",dialogClass:"jrDialog",resizable:!1,modal:!0,autoOpen:!0,position:"center"};r=e.extend(r,n);if(jreviews.mobi==1){r.maxWidth=r.width;r.width="95%";r.position="center top"}if(e.trim(t)===""){t=jreviews.__t("PROCESS_REQUEST_ERROR");r.buttons={}}i.html(t);i.dialog(r);var s=e(".ui-dialog-buttonpane");typeof jQuery().button=="function"&&s.find("button").button("destroy");jreviews.mobi==1&&s.find(".ui-dialog-buttonset").css("float","left");var o=s.find("button:contains("+jreviews.__t("DELETE")+")"),u=s.find("button:contains("+jreviews.__t("SUBMIT")+")"),a=s.find("button:contains("+jreviews.__t("CANCEL")+")");o.addClass("jr-submit jrButton").prepend('<span class="jrIconDelete"></span>');u.addClass("jr-submit jrButton").prepend('<span class="jrIconSave"></span>').on("click",function(){e(this).attr("disabled","disabled").find("span").removeClass("jrIconSave").addClass("jrButtonSpinner")});a.addClass("jr-cancel jrButton").prepend('<span class="jrIconCancel"></span>');i.on("failedValidation",function(){u.removeAttr("disabled").find("span").removeClass("jrButtonSpinner").addClass("jrIconSave")});return i};e.jrAlert=function(t){e("div.jr-alert").dialog("destroy").remove();var n={},r=e('<div class="jr-alert">'+t+"</div>");n={title:"",width:"400px",height:"auto",dialogClass:"jrDialog",resizable:!1,modal:!0,autoOpen:!0,position:"center",buttons:{}};n.buttons[jreviews.__t("CLOSE")]=function(){e(this).dialog("close")};if(jreviews.mobi==1){n.maxWidth=n.width;n.width="95%";n.position="center top"}r.dialog(n)}})(jQuery);(function(e){e.getCSS=function(t,n){e(document.createElement("link")).attr({href:t,media:n||"screen",type:"text/css",rel:"stylesheet"}).appendTo("head")}})(jQuery);(function(e){e.fn.jrScrollTo=function(t,n){var r=e.extend({},e.fn.jrScrollTo.defaults,t),i=e(this).offset().top+r.offset;e("html,body").animate({scrollTop:i},r.duration,r.easing,n);return e(this)};e.fn.jrScrollTo.defaults={offset:-30,duration:1e3,easing:"swing"}})(jQuery);(function(e){e.fn.tinyMCE=function(){var e=this,t=1e3;try{setTimeout(function(){if(typeof tinyMCE=="object")return e.each(function(){tinyMCE.execCommand("mceAddControl",!1,this.id)})},t)}catch(n){console(n)}};e.fn.RemoveTinyMCE=function(){var e=this;try{if(typeof tinyMCE=="object")return e.each(function(){tinyMCE.execCommand("mceRemoveControl",!0,this.id)})}catch(t){}}})(jQuery);(function(e){var t=function(t,n){this.elem=t;this.$elem=e(t);this.options=e.extend({},e.fn.jrShowMore.options,n);this.init()};t.prototype={init:function(){var t=this,n=t.$elem.data("characters"),r=t.$elem.data("separator");n!=undefined&&parseInt(n)>0&&(t.options.characters=n);r!=undefined&&(t.options.separator=r);t.elemText=t.$elem.text().trim();t.elemLength=t.elemText.length;if(t.elemLength>t.options.characters+t.options.separator.length){t.elemTextMain=t.elemText.substring(0,t.options.characters);t.elemTextMore=t.elemText.substring(t.options.characters,t.elemLength);t.elemTextSeparatorHTML='<span class="jrShowMoreSeparator">'+t.options.separator+"</span>";t.elemTextMoreHTML='<span class="jrShowMore" style="display: none;">'+t.elemTextMore+"</span>";t.elemTextMoreLink='<a class="jrShowLink" href="#">'+t.options.showMoreText+"</a>";t.$elem.html(t.elemTextMain+t.elemTextSeparatorHTML+t.elemTextMoreHTML+" "+t.elemTextMoreLink);t.$elem.on("click","a",function(n){n.preventDefault();var r=e(this);r.hasClass("jrShowLink")?r.html(t.options.hideMoreText).removeClass("jrShowLink").addClass("jrHideLink"):r.html(t.options.showMoreText).removeClass("jrHideLink").addClass("jrShowLink");t.$elem.find(".jrShowMoreSeparator").toggle();t.$elem.find(".jrShowMore").toggle()})}}};e.fn.jrShowMore=function(e){return this.each(function(){new t(this,e)})};e.fn.jrShowMore.options={showMoreText:jreviews.__t("SHOW_MORE"),hideMoreText:jreviews.__t("HIDE_MORE"),separator:"...",characters:250}})(jQuery);(function(e){var t=function(t,n){this.elem=t;this.$elem=e(t);this.options=e.extend({},e.fn.jrPopup.options,n);this.init()};t.prototype={init:function(){var t=this;t.popupDiv=t.$elem.next("."+t.options.className);if(t.popupDiv.length&&(e.trim(t.popupDiv.html())!==""||t.popupDiv.hasClass("jr-ajax"))){t.$popupDiv=e(t.popupDiv);t.$elem.hover(function(){t.show()},function(){t.hide()});t.$elem.click(function(){t.hide()});t.$popupDiv.hover(function(){t.show()},function(){t.hide()})}},show:function(){var e=this;e.options.onBeforeShow&&e.options.onBeforeShow();var t=e.getPosition();e.$popupDiv.stop(!0,!0);e.clearTimeouts();e.showTimeout=setTimeout(function(){e.$popupDiv.appendTo("body").css({top:t.top,left:t.left});e.$popupDiv.fadeIn(100)},300)},hide:function(){var t=this;t.clearTimeouts();t.showTimeout=setTimeout(function(){e(t.popupDiv).fadeOut(100,function(){t.$elem.after(e(this))})},t.options.delay)},clearTimeouts:function(){if(this.showTimeout){clearTimeout(this.showTimeout);this.showTimeout=0}if(this.showTimeout){clearTimeout(this.showTimeout);this.showTimeout=0}},getPosition:function(){var e=this.$elem.offset().top,t=this.$elem.offset().left,n=this.$elem.outerWidth(),r=this.$elem.outerHeight();return{left:t+n/2-this.$popupDiv.outerWidth()/2+"px",top:e-this.$popupDiv.outerHeight()-20+"px"}}};e.fn.jrPopup=function(e){return this.each(function(){new t(this,e)})};e.fn.jrPopup.options={className:"jrPopup",delay:300}})(jQuery);(function(e){var t=function(e){if(typeof e!="string")throw"sprintf: The first arguments need to be a valid format string.";var t=new RegExp(/%(\+)?([0 ]|'(.))?(-)?([0-9]+)?(\.([0-9]+))?([%bcdfosxX])/g),n=[],r=1;while(part=t.exec(e)){if(r>=arguments.length)throw"sprintf: At least one argument was missing.";n[n.length]={begin:part.index,end:part.index+part[0].length,sign:part[1]=="+",negative:parseInt(arguments[r])<0?!0:!1,padding:part[2]==undefined?" ":part[2].substring(0,1)=="'"?part[3]:part[2],alignLeft:part[4]=="-",width:part[5]!=undefined?part[5]:!1,precision:part[7]!=undefined?part[7]:!1,type:part[8],data:part[8]!="%"?String(arguments[r++]):!1}}var i="",s=0;for(var o=0;o<n.length;++o){i+=e.substring(s,n[o].begin);s=n[o].end;var u="";switch(n[o].type){case"%":u="%";break;case"b":u=Math.abs(parseInt(n[o].data)).toString(2);break;case"c":u=String.fromCharCode(Math.abs(parseInt(n[o].data)));break;case"d":u=String(Math.abs(parseInt(n[o].data)));break;case"f":u=n[o].precision==0?String(Math.abs(parseFloat(n[o].data))):Math.abs(parseFloat(n[o].data)).toFixed(n[o].precision);break;case"o":u=Math.abs(parseInt(n[o].data)).toString(8);break;case"s":u=n[o].data.substring(0,n[o].precision?n[o].precision:n[o].data.length);break;case"x":u=Math.abs(parseInt(n[o].data)).toString(16).toLowerCase();break;case"X":u=Math.abs(parseInt(n[o].data)).toString(16).toUpperCase();break;default:throw'sprintf: Unknown type "'+n[o].type+'" detected. This should never happen. Maybe the regex is wrong.'}if(n[o].type=="%"){i+=u;continue}if(n[o].width!=0&&n[o].width>u.length){var a=u.length;for(var f=0;f<n[o].width-a;++f)u=n[o].alignLeft==1?u+n[o].padding:n[o].padding+u}if(n[o].type=="b"||n[o].type=="d"||n[o].type=="o"||n[o].type=="f"||n[o].type=="x"||n[o].type=="X")n[o].negative==1?u="-"+u:n[o].sign==1&&(u="+"+u);i+=u}i+=e.substring(s,e.length);return i};e.sprintf=t;String.prototype.printf=function(){var e=Array.prototype.slice.call(arguments);e.unshift(String(this));return t.apply(undefined,e)}})(window);(function(e){e.widget("jreviews.buttongroup",{buttons:{},classes:{buttonGroup:"jrButtonGroup",button:"jrButton",selected:"jrBlue"},_create:function(){var t=this,n=t.element,r=t.classes;n.hide();var i=e('<div class="'+r.buttonGroup+'">');n.find("option").each(function(s){var o=e(this),u=e('<div class="'+r.button+'">').html(o.text()).data("index",s),a=o.data("icon");a&&u.prepend('<span class="'+a+'">');u.on("click",function(){n.find("option:eq("+e(this).data("index")+")").attr("selected","selected");o.trigger("change")});t.buttons[s]=u;o.val()!==""&&i.append(u)});n.on("change",function(){i.find("."+r.button).removeClass(r.selected);t.buttons[n.find("option:selected").index()].addClass(r.selected)});i.insertBefore(n)},_init:function(){var e=this,t=e.element;t.trigger("change")},destroy:function(){e.Widget.prototype.destroy.call(this)}})})(jQuery);